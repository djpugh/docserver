os:
- linux
language: python
python:
- 3.7
branches:
  except:
  - gh-pages
install:
- pip install tox
stages:
- name: lint
- name: test
- name: build
  if: tag =~ ^\d+\.\d+\.\d+$
- name: docker
  if: tag =~ ^\d+\.\d+\.\d+$
script: skip
jobs:
  fast_finish: true
  include:
  - stage: lint
    script: tox -e lint
    python: 3.7
    name: Lint
  - stage: test
    script: tox -e test-py36
    python: 3.7
    name: Unit Tests
  - stage: build
    python: 3.7
    name: Build Package
    script: tox -e build-package
    deploy:
      provider: releases
      api_key:
        secure: n94h3v1FMLG9TmNrIx5uNlyssoS9RycZbL8W+eogAZhFzutjtHl0GXfD/TvksajktuhOCTpRaElpz5LJB4v2RbH6Wt73ipazsC3K3868d/hnlK75qzdJa63+pkyyPATA6d+A0vRdBN7zFNthqsaVeCWFhHdjp/3pWL/uaXQQoFBTvCovFaXcq+VfpQRvdy/ZNkO1Jr5Z+DvQqaxN+bss67EJH+3q/7/WgSRH00U8Wb/pN5yd/i6/A7nLWSfJFfAjI5MSkWV3yTLUtoBxzsBGqM9OhHT2tEpojxKRD41noZwyszjSERWxn9CBRH1diT61Z7jSw/pwoYUJ8KRmJ9PjfOegS1DGv/maHTeUvLqtWNouLkWEchzpMeyhqq9awD4nYYWJ3Zv81ebRzETQcoQ40nBvkFMXAzNU1BRVsbHP2p0tfF5GIoZ/2W0SXt9WoOJZfHB/Hy5G+SC9Cq3hZYmaqB0V6Oz2ezZ/tJPcloWndO4J0sMAMt+VEdBqMr58hkzGj2ALInQlqkEVepVqDIAOliCxap3d/LlnvfonS3PrsiJEHboiDlto66C1nQuLsHlwrnffW4Tb/GQ9hZbRq1++ljq2PFu4sG2jjgjqad0FiLLGTRLJubhKaZEDcaFP38zk+m8fQ40HPSyU8k0casWdV1LdvcbxCUHe0zBZrUpPfBs=
      file: dist/*
      on:
        repo: djpugh/docserver
  - stage: docker
    script:
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    - tox -e build-docker
    - docker images
    - docker tag docserver:$TRAVIS_TAG $DOCKER_USERNAME/docserver:$TRAVIS_TAG
    - docker push $DOCKER_USERNAME/docserver:$TRAVIS_TAG
    - docker tag docserver:$TRAVIS_TAG $DOCKER_USERNAME/docserver:latest
    - docker push $DOCKER_USERNAME/docserver:latest
    python: 3.7
    name: Build Docker Image
env:
  global:
  - secure: m1MiBJJ0WRScK0sJTDiZzR/OiV5u7jwm7NhcRGijTaPKSYmDMiMoNUKdlHXbB7cehjPYH2ZYIbusW4nZAuZBsjU+6NVAy1E8FQatC0y7kyDUXYx6bS6PGc1e3qs6NdKDXXSoihZqb0L61pSi76ZK+aqEuwvj3J34cpzvt07/LC3b6vFur6d5CbjeIwd7d5ns85V1HBHQOyAotqwwbebQJYWy69ma54Wfe/3HNknW2I8CTkT0+Tv1DstyrO+QMrsxod1jpkbwGyASM0Nv9LrkkNfFmYYbNhIRXFg5Y9cAkVQxdzQozgIGIYsW6PS4o5ieRUPPY0/a+zc6W+r2AysJs2Fs3t9SgoTAqpMKd0F5paOBjyRXe7dKaTWZy0WmQGuwR2vDmeDcsjmMSemGX5dWnyFswtrpHVXeZn+u+sMc7XB71xLeal+97ebOhdzg19OQc12vvYZq9Tm6PjpngRItb6d2zZNYozG4XJ+3+MT7xz7hwfvDpjEICJsXtzKTakMoQXeN8dwo+ebI3aNjfBPz0UWQ3lDH/Xh0z8loRmZHY1ALIxy+ON3S/6QTP8GKksG20/VDROrV4hqsKDAr9Jux7pv5bpiH3Fh//ogqDPAERj0v5XaXz261ac8OeIM30h/6dyFIcAGjXDGw943MTBR3r3ke0f/pH1F3Fsz3BcEriso=
  - secure: lleZD3hECOEKLnVD/bBkmygBx53BjIaK0rIyJwxLgyd8SkmM2hbh5PSlwwCmhZKpo37uj4M1FE6qsJTleBWp2JulgX5qlW3zDAOFeVG92n8PM0PA9ofT1HevqeIMfIH4jMim8b/XkKnt7Dy8Yh+6QakdGoM2AOdFS3HazZ+phvNg6eCx+96RpOfbKqPR4H7KzUFFoh63zsrCJbenlZCE1Zmlj+Hd6rbhQ7P+iVxfM9WTI+ur8ts+pMQLZBkw5IfUUAShACj0W59ydAQssitgLSxmt5Xz1swOBsLxvgOdAtiiH3eFyjFnjzEjYekPBhKfH3XVDIpMOSUPAQvgKuPQ1mE1kzQq6SYVrRFOWuKU/v59UOgXWrPQd0eebmlu/hwlinbAHTmb2lUpmBQ8Xr66xEx80Nrzb4orVYLfwFs2D2EaHAQ5TYlVR6Sxg5IDOaC/6dvdC0EIwnU0dSHQ+B81f/swSmsROyTpETgc+UT8UhJJkgQvdLwYFkEVM0rQmD1pIL0SLsBmMGrKAjlBXt5SecwfzxLKdbKVFjRFJS+ssWpkIFm2xvT8/rI/nRyrjuD7Yez0Wf8D2fNoC/0IL3/zE1U4l1fZjdMlFp7V8YuhOc1sIwNvHBv9Ld6s8lrTvohUZkUrk/ONOfK/XCz5QtRLzfv/tsCR2uRJAJHMOJc907s=

